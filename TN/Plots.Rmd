---
title: "temperature"
author: "Shengye (Tony) Niu"
date: "14/04/2021"
output: html_document
---

```{r}
library(plotly)
library(tidyverse)
library(tidyr)
table <- read.delim("/data/temperature.txt", header=FALSE)
table <- data.frame(table)

data <- 
  table %>% 
  slice(5:length(table[,1])) %>% 
  separate(V1, c("Year", "No_Smoothing", "Lowess"), sep="     ")

data$No_Smoothing = as.numeric((data$No_Smoothing))
data$Lowess = as.numeric((data$Lowess))

head(data)

fig <- plot_ly(data, x = ~Year, y = ~Lowess, type = 'scatter', 
               mode = 'lines', showlegend=TRUE, color = I("#EF476F"), width=700, height=595)
fig <- fig %>% layout(title = list(text = paste0('... and global temperatures continue to rise',
                                    '<br>',
                                    '<sup>',
                                    'Global Land-Ocean Temperature Index',
                                    '</sup>'), 
                                   x = 0.1,
                                   y = 0.9,
                                   font = list(
                                     family = "arial",
                                     size = 20)),
                      margin = list(l = 100,
                                    r = 50,
                                    b = 100,
                                    t = 100,
                                    pad = 20), 
         paper_bgcolor="#d2d2d1", plot_bgcolor="#d2d2d1",
         xaxis = list(title = "Year",
                      gridcolor = "white",
                      showgrid = TRUE,
                      showline = FALSE,
                      tickvals = list(1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020),
                      zeroline = FALSE,
                      tickfont = list(family = "arial", size = 14),
                      titlefont = list(family = "arial", size = 14)),
         yaxis = list(title = "Temperature Anomaly (C)",
                      gridcolor = "white",
                      showgrid = TRUE,
                      showline = FALSE,
                      zeroline = FALSE,
                      tickfont = list(family = "arial", size = 14),
                      titlefont = list(family = "arial", size = 14))) 

fig %>% 
    add_annotations(text="Data source: NASA's Goddard Institute for Space Studies (GISS)", 
                    xref='paper',
                    yref='paper',
                    x=0.65,y=-0.22,
                    showarrow=FALSE, 
                    font = list(family = "arial", size = 14))

```



```{r}
library("readxl")

cat <- read_excel("/data/CAT.xlsx")
cat <- cat[-c(1, 2, 3, 4, 5, 6, 7), ]

cat[1, 2] <- '0'

years <- as.numeric(t(cat[1,-c(1, 2)]))

ar5_high <- as.numeric(t(cat[2,-c(1, 2)]))
ar5_low <- as.numeric(t(cat[3,-c(1, 2)]))
ar5 <- data.frame("years" = years, "ar5_high" = as.numeric(ar5_high), "ar5_low" = as.numeric(ar5_low))
ar5 <- drop_na(ar5)
ar5$ar5_med <- rowMeans(ar5[,c("ar5_low", "ar5_high")])

#The default order will be alphabetized unless specified as below:
ar5$years <- factor(ar5$years, levels = ar5[["years"]])

fig <- plot_ly(ar5, x = ~years, y = ~ar5_high, type = 'scatter', mode = 'lines',
        line = list(color = 'rgba(0,100,80,1)'),
        showlegend = FALSE, name = 'High ar5')
fig <- fig %>% add_trace(y = ~ar5_low, type = 'scatter', mode = 'lines',
            fill = 'tonexty', fillcolor='rgba(0,100,80,0.2)', line = list(color = 'rgba(0,100,80,1)'),
            showlegend = FALSE, name = 'Low ar5')
fig <- fig %>% layout(title = "High and Low ar5",
         paper_bgcolor='rgb(255,255,255)', plot_bgcolor='rgb(229,229,229)',
         xaxis = list(title = "Years",
                      gridcolor = 'rgb(255,255,255)',
                      showgrid = TRUE,
                      showline = FALSE,
                      showticklabels = TRUE,
                      tickcolor = 'rgb(127,127,127)',
                      ticks = 'outside',
                      zeroline = FALSE),
         yaxis = list(title = "AR5 Y AXIS",
                      gridcolor = 'rgb(255,255,255)',
                      showgrid = TRUE,
                      showline = FALSE,
                      showticklabels = TRUE,
                      tickcolor = 'rgb(127,127,127)',
                      ticks = 'outside',
                      zeroline = FALSE))

fig

# the above approach worked


# below is the data that's processed

years <- as.numeric(t(cat[1,-c(1, 2)]))

ar5_high <- as.numeric(t(cat[2,-c(1, 2)]))
ar5_low <- as.numeric(t(cat[3,-c(1, 2)]))
ar5 <- data.frame("years" = years, "ar5_high" = as.numeric(ar5_high), "ar5_low" = as.numeric(ar5_low))
ar5 <- drop_na(ar5)

#The default order will be alphabetized unless specified as below:
ar5$years <- factor(ar5$years, levels = ar5[["years"]])


current_high <- as.numeric(t(cat[4,-c(1, 2)]))
current_low <- as.numeric(t(cat[5,-c(1, 2)]))
current <- data.frame("years" = years, "current_high" = as.numeric(current_high), "current_low" = as.numeric(current_low))
current <- drop_na(current)

current$years <- factor(current$years, levels = current[["years"]])


# haven't formatted the data below yet but it'll look the same as the ones above
pledge_high <- as.numeric(t(cat[6,-c(1, 2)]))
pledge_low <- as.numeric(t(cat[7,-c(1, 2)]))
pledge <- data.frame(years, pledge_high, pledge_low)

opt <- as.numeric(t(cat[8,-c(1, 2)]))

c2_high <- as.numeric(t(cat[9,-c(1, 2)]))
c2_med <- as.numeric(t(cat[10,-c(1, 2)]))
c2_low <- as.numeric(t(cat[11,-c(1, 2)]))
c2 <- data.frame(years, c2_high, c2_med, c2_low)

c15_high <- as.numeric(t(cat[12,-c(1, 2)]))
c15_med <- as.numeric(t(cat[13,-c(1, 2)]))
c15_low <- as.numeric(t(cat[14,-c(1, 2)]))
c15 <- data.frame(years, c15_high, c15_med, c15_low)

historical <- as.numeric(t(cat[14,-c(1, 2)]))





```

```{r}
month <- c('January', 'February', 'March', 'April', 'May', 'June', 'July',
           'August', 'September', 'October', 'November', 'December')
high_2014 <- c(28.8, 28.5, 37.0, 56.8, 69.7, 79.7, 78.5, 77.8, 74.1, 62.6, 45.3, 39.9)
low_2014 <- c(12.7, 14.3, 18.6, 35.5, 49.9, 58.0, 60.0, 58.6, 51.7, 45.2, 32.2, 29.1)
data <- data.frame(month, high_2014, low_2014)
data$average_2014 <- rowMeans(data[,c("high_2014", "low_2014")])

#The default order will be alphabetized unless specified as below:
data$month <- factor(data$month, levels = data[["month"]])

fig <- plot_ly(data, x = ~month, y = ~high_2014, type = 'scatter', mode = 'lines',
        line = list(color = 'rgba(0,100,80,1)'),
        showlegend = FALSE, name = 'High 2014')
fig <- fig %>% add_trace(y = ~low_2014, type = 'scatter', mode = 'lines',
            fill = 'tonexty', fillcolor='rgba(0,100,80,0.2)', line = list(color = 'rgba(0,100,80,1)'),
            showlegend = FALSE, name = 'Low 2014')
fig <- fig %>% layout(title = "High and Low Temperatures in New York",
         paper_bgcolor='rgb(255,255,255)', plot_bgcolor='rgb(229,229,229)',
         xaxis = list(title = "Months",
                      gridcolor = 'rgb(255,255,255)',
                      showgrid = TRUE,
                      showline = FALSE,
                      showticklabels = TRUE,
                      tickcolor = 'rgb(127,127,127)',
                      ticks = 'outside',
                      zeroline = FALSE),
         yaxis = list(title = "Temperature (degrees F)",
                      gridcolor = 'rgb(255,255,255)',
                      showgrid = TRUE,
                      showline = FALSE,
                      showticklabels = TRUE,
                      tickcolor = 'rgb(127,127,127)',
                      ticks = 'outside',
                      zeroline = FALSE))

fig
```



```{r}
# did not work
p <- ggplot(ar5, aes(x=years, y=ar5_med), color='blue')
p + geom_path()
p + geom_ribbon(aes(ymin = ar5_low, ymax = ar5_high),
                fill = "steelblue") +
  geom_path(size = 0.8)
fig <- ggplotly(p)
fig


p <- ggplot(ar5) + geom_line(aes(y=ar5_med, x=years, colour = "sin")) +
  geom_ribbon(aes(ymin=ar5_low, ymax=ar5_high, x=years, fill = "band"), alpha = 0.3) +
  scale_colour_manual("",values="blue")+
  scale_fill_manual("",values="blue")

fig <- ggplotly()

fig
```

